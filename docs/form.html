<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="./css/spin.css">
    <script type="text/javascript" src="./scripts/spin.js"></script>
    <script type="text/javascript">
        // Safariで表示直後にボタンが無反応なのを防ぐ。
        // + spinner
        var op = {
            length: 38, width: 17, radius: 45,
            top: '50%', position: 'fixed'
        };
        var sp = new Spinner(op);
        document.onreadystatechange = function (ev) {
            var state = document.readyState;
            if (state == 'interactive') {
                sp.spin(document.getElementById('spin'));
            }else if (state == 'complete') {
                var base_div = document.getElementById('base_div');
                base_div.style.visibility = 'visible';
                sp.stop();
            }
        };
    </script>
    <title>続・レターパックプラスラベルメイカー</title>
</head>
<body>

    <div id="spin"></div>

    <link rel="stylesheet" type="text/css" href="./css/styles.css">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://ajaxzip3.github.io/ajaxzip3.js" charset="UTF-8"></script>
    <script type="text/javascript" src="./scripts/pdfmake.min.js"></script>
    <script type="text/javascript" src="./scripts/form_script.js"></script>
    <script type="text/javascript" src='./scripts/vfs_fonts.js'></script>
    <script type="text/javascript" src="./scripts/imagedata_plus.js"></script>
    <script type="text/javascript" src="./scripts/imagedata_light.js"></script>
    <script type="text/javascript" src="./scripts/defineDocCore.js"></script>
    <script type="text/javascript" src="./scripts/pdf_script.js"></script>
    <script type="text/javascript" src="./scripts/file_dl.js"></script>
    <script type="text/javascript" src="./scripts/file_load.js"></script>

    <div id="base_div">
        <div id="head1"></div>

        <img id="base_img" src="./imgs/plus_base.png">

        <h1>続・<a href="http://www.post.japanpost.jp/service/letterpack/" target="_blank">レターパックプラス</a>ラベルメイカー</h1>
        <div id="overview">
            フォーム入力だけで作成出来ます。<br>
            文字数オーバーすると赤くなります。(そのままでもPDF出力は可能です。)<br>
            <a href="form.html?light">ライトはこちら</a>です。<br>
            PC上で無制限に使いたい方は<a href="https://paymo.life/shops/923e69bf8d/pg4GA2T8UX" target="_blank" title="1000円">有料版</a>をご検討ください。
        </div>
        <button id="reverse_button" class="h_button" title="ToとFromを入れ替え">
            Reverse
        </button>
        <button id="clear_to_button" class="h_button" title="お届け先削除">
            Clear To
        </button>
        <button id="clear_all_button" class="h_button" title="全削除">
            Clear All
        </button>
        
        <input type="text" name="to_zip" id="to_zip" placeholder="郵便番号" title="半角数字7桁" autofocus>
        <textarea name="to_add" id="to_add" placeholder="住所 (14文字 x 4行)" rows=4 title="郵便番号から自動入力"></textarea>
        <textarea name="to_name" id="to_name" placeholder="名前 (13文字 x 2行)" rows=2></textarea>
        <input type="text" name="to_tel1" id="to_tel1" placeholder="TEL1" title="半角数字4桁" class="tel">
        <input type="text" name="to_tel2" id="to_tel2" placeholder="TEL2" title="半角数字4桁" class="tel">
        <input type="text" name="to_tel3" id="to_tel3" placeholder="TEL3" title="半角数字4桁" class="tel">

        <input type="text" name="from_zip" id="from_zip" placeholder="郵便番号" title="半角数字7桁">
        <textarea name="from_add" id="from_add" placeholder="住所 (20文字 x 2行)" rows=2 title="郵便番号から自動入力"></textarea>
        <textarea name="from_name" id="from_name" placeholder="名前 (20文字 x 2行)" rows=2></textarea>
        <input type="text" name="from_tel1" id="from_tel1" placeholder="TEL1" title="半角数字4桁" class="tel">
        <input type="text" name="from_tel2" id="from_tel2" placeholder="TEL2" title="半角数字4桁" class="tel">
        <input type="text" name="from_tel3" id="from_tel3" placeholder="TEL3" title="半角数字4桁" class="tel">
        <textarea name="desc" id="desc" placeholder="品名 (19文字 x 2行)" rows=2></textarea>

        <button id="save_button" title="入力内容をファイルに保存" class="f_button">
            Save
        </button>
        <button id="make_button" class="f_button" title="pdf作成">
            Make PDF
        </button>
        <button id="load_button" title="jsonファイルから読み込み" class="f_button">
            Load
        </button>
        <input type="file" name="load_file" id="load_file" accept=".json">
        <div id="badges">

            <a href="https://hamada2029.github.io/letterpack_label/donation.html" target="_blank" title="よろしければご寄付をお願いします。15円~">
                <img id="donate" src="https://img.shields.io/badge/15yen~-donate-ff5555.svg?logo=amazon&style=for-the-badge">
            </a>
            <a href="http://satuptown.blogspot.com/2018/09/blog-post.html" target="_blank" title="コメントなど">
                <img id="blogger" src="https://img.shields.io/badge/blogger-sat_up_town-ff5555.svg?logo=blogger&style=for-the-badge">
            </a>

        </div>

        <div id="mask">
            <iframe id="frame1" name="frame1"></iframe>
            <a id="dl_link"></a>
            <button id="dl_button">Download</button>
            <button id="print_button">Print</button>
            <button id="close_button" title="閉じる">x</button>
        </div>


    </div>

    <script type="text/javascript" src="./scripts/plus_or_light.js">
    </script>

    <script type="text/javascript">
        $('#save_button').on('click', fileDL);
        $('#load_button').on('click', function(){
            $('#load_file').click();
        });
        $('#load_file').on('change', loadData);


        $('#to_zip').on(
            'keyup',
            function(){
                AjaxZip3.zip2addr(this, '', 'to_add', 'to_add');
            }
        );
        $('#from_zip').on(
            'keyup',
            function(){
                AjaxZip3.zip2addr(this, '', 'from_add', 'from_add');
            }
        );

        $('#make_button').on('click', makePDF);

        $('body').on('load', checkLen);
        $('input[type="text"]').on('keyup', checkLen);

        $('body').on('load', checkAreaLen);
        $('textarea').on('keyup', checkAreaLen);

        $('#reverse_button').on('click', reverse);
        $('#clear_all_button').on('click', clearAll);
        $('#clear_to_button').on('click', clearTo);


        $('#dl_button').on(
            'click',
            function(){
                var j = getVs();
                var link = $('#dl_link')[0];
                link.download = j.file_name.replace('.json', '.pdf');
                link.href = frame1.location.href;
                link.click();
                link.href = '';
            }
        );
        $('#print_button').on(
            'click', function(){frame1.print();}
        );
        $('#close_button').on(
            'click',
            function(){
                $('#mask').css('visibility', 'hidden');
                $('#mask button').css('visibility', 'hidden');
            }
        );
    </script>
</body>

</html>


